<!DOCTYPE html>

<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>
        Gravity Device
    </title>
    <script>
function s_ajax(b) {
    var c = new XMLHttpRequest();
    c.onreadystatechange = function() {
        if (c.readyState == 4) {
            if (c.status == 200) {
                b.success(c.responseText)
            } else {
                c.onerror(c.status)
            }
        }
    };
    c.ontimeout = function() {
        if (typeof b["timeout"] != "undefined") b.timeout();
        else c.onerror(-1)
    }, c.onerror = function(a) {
        if (typeof b["fail"] != "undefined") b.fail(a)
    };
    c.open(b.m, b.url, true);
    if (typeof b["data"] != "undefined") {
        c.setRequestHeader("Content-Type", (typeof b["mime"] != "undefined") ? b["mime"] : "application/x-www-form-urlencoded");
        c.send(b.data)
    } else c.send()
}

var Q = function(d) {
    return document.querySelector(d);
};
</script>
    <script>
var gdcurl = "/gdc";

function toFixed() {
    var texts = document.querySelectorAll("input[type=text]");
    for (var i = 0; i < texts.length; i++) {
        texts[i].onchange = function() {
            if (this.value.match(/[\-\d\.]+e[\+\-][\d]+/))
                this.value = Number(this.value).toFixed(9);
        };
    }
}

function fill(setting) {
    for (var name in setting) {
        var ele = Q("input[name=" + name + "]");
        if (ele) {
            if (ele.type == "checkbox") ele.checked = setting[name];
            else ele.value = setting[name];
        }
    }
}

function save() {
    var inputs = document.getElementsByTagName("input");
    var setting = {};
    for (var i = 0; i < inputs.length; i++) {
        var ele = inputs[i];
        if (ele.type == "checkbox") setting[ele.name] = ele.checked;
        else if (ele.type == "text") setting[ele.name] = ele.value;
    }
    //    console.log("result=" + setting);
    s_ajax({
        url: gdcurl,
        m: "POST",
        mime: "aplication/json",
        data: JSON.stringify(setting),
        success: function(a) {
            alert("Done");
        },
        fail: function(a) {
            alert("failed updating data:" + a)
        }
    });
}

function init(classic) {
    if (typeof classic == "undefined") classic = false;

    if (!classic) {
        getActiveNavItem();
        Q("#verinfo").innerHTML = "v" + JSVERSION;
    }
    toFixed();
    s_ajax({
        url: gdcurl + "?data",
        m: "GET",
        success: function(a) {
            fill(JSON.parse(a));
        },
        fail: function(a) {
            //alert("failed getting data:" + a)
        }
    });
}
</script>
</head>

<body onload="init(true)">
    <form action="" method="post">
        <table>
            <tr>
                <td>
                    Use Plato
                </td>
                <td><input type="checkbox" name="plato" value="1"> </td>
            </tr>
            <tr>
                <td>iSpindel</td>
                <td><input type="checkbox" name="ispindel" value="1"></td>
            </tr>
            <tr>
                <td>
                    Calculated by BPL
                </td>
                <td><input type="checkbox" name="cbpl" value="1"> </td>
            </tr>
            <tr>
                <td>
                    Coefficients
                </td>
                <td><input type="text" name="a3" size="15">*x^3 + <input type="text" name="a2" size="15">*x^2+ <input type="text" name="a1" size="15">*x + <input type="text" name="a0" size="15"> </td>
            </tr>
            <tr>
                <td>
                    Temp. Correction
                </td>
                <td><input type="checkbox" name="tc" value="1"> @ <input type="text" name="ctemp" size="4">&deg;C </td>
            </tr>
            <tr>
                <td>
                    LowPass Filter Coefficient
                </td>
                <td><input type="text" name="lpc" size="4"> </td>
            </tr>
            <tr>
                <td>
                    Gravity Stability Threshold
                </td>
                <td><input type="text" name="stpt" size="4">
                    point, 1= 0.001 for SG, or 0.1&deg;P for Plato
                </td>
            </tr>
            <tr>
                <td>
                    Save Change
                </td>
                <td><input type="submit" name="submit" onclick="save();return false;">
                </td>
            </tr>
        </table>
    </form>
</body>

</html>