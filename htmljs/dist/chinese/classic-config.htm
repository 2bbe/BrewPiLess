<html><head><title> BrewPiLess系統組態 </title><script>function s_ajax(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&(200==t.status?e.success(t.responseText):t.onerror(t.status))},t.ontimeout=function(){void 0!==e.timeout?e.timeout():t.onerror(-1)},t.onerror=function(t){void 0!==e.fail&&e.fail(t)},t.open(e.m,e.url,!0),void 0!==e.data?(t.setRequestHeader("Content-Type",void 0!==e.mime?e.mime:"application/x-www-form-urlencoded"),t.send(e.data)):t.send()}var Q=function(e){return document.querySelector(e)}</script><script>function formatIP(a){return"0.0.0.0"==a?"":a}function verifyIP(a){var e=this.value.split("."),t=!0;if(4==e.length)for(var i=0;i<4;i++){if(parseInt(e[i])>255){t=!1;break}}else t=""==this.value;t?(this.saved=this.value,this.value=formatIP(this.value)):this.value=formatIP(this.saved)}function loadSetting(){s_ajax({url:"config?cfg=1",m:"GET",success:function(a){var e=JSON.parse(a);window.oridata=e,Object.keys(e).map(function(a){var t=Q("input[name="+a+"]");t?t.classList.contains("iptype")?(t.value=formatIP(e[a]),t.saved=e[a],t.onchange=verifyIP):"checkbox"==t.type?t.checked=0!=e[a]:t.value=e[a]:(t=Q("select[name="+a+"]"))&&(t.value=e[a])})},fail:function(a){alert("error getting data:"+a)}})}function waitrestart(){Q("#waitprompt").style.display="block",Q("#inputform").style.display="none",setTimeout(function(){window.location.reload()},15e3)}function save(){var a=document.querySelectorAll("input"),e={},t=!1;Object.keys(a).map(function(i,n){var o;"submit"!=a[n].type&&(a[n].name&&""!=a[n].name&&(o=a[n].classList.contains("iptype")?a[n].saved:"checkbox"==a[n].type?a[n].checked?1:0:a[n].value.trim(),e[a[n].name]=o,window.oridata[a[n].name]==o||a[n].classList.contains("nb")||(t=!0)))});var i=Q("select[name=wifi]");window.oridata.wifi!=i.value&&(t=!0),e.wifi=i.value,console.log(JSON.stringify(e)),s_ajax({url:"config"+(t?"":"?nb"),data:"data="+encodeURIComponent(JSON.stringify(e)),m:"POST",success:function(a){t&&waitrestart()},fail:function(a){alert("error saving data:"+a)}})}function load(){Q("#verinfo")&&(Q("#verinfo").innerHTML="v"+JSVERSION),loadSetting()}</script><style>#waitprompt{display:none}</style></head><body onload=load()><div id=waitprompt> 設定已儲存，等待重新啓動中。請注意：如果有更改主機名稱，自動載入不會成功。 </div><div id=inputform><form action=/setconfig action=post><table><tr><td> LCD自動關閉 </td><td><input name=aoff type=text size=5 maxlength=5 class=nb> 秒 </td></tr><tr><td> 網頁名稱 </td><td><input name=title type=text size=12 maxlength=24></td></tr><tr><td> 網路主機名稱 </td><td><input name=name type=text size=12 maxlength=16></td></tr><tr><td> HTTP Port </td><td><input name=port type=text size=5 maxlength=5></td></tr><tr><td> 使用者名稱 </td><td><input name=user type=text size=12 maxlength=16></td></tr><tr><td> 密碼 </td><td><input name=pass type=password size=12 maxlength=16></td></tr><tr><td> 全部頁面要求密碼 </td><td><input type=checkbox name=protect></td></tr><tr><td> 網路設定 </td><td><select name=wifi><option value=1>Station</option><option value=2>AP</option><option value=3>Station + AP</option></select></td></tr><tr><td> 固定IP </td><td><input type=text name=ip size=16 class=iptype></td></tr><tr><td> Gateway </td><td><input type=text name=gw size=16 class=iptype></td></tr><tr><td> Netmask </td><td><input type=text name=mask size=16 class=iptype></td></tr><tr><td> 儲存變更 </td><td><input type=submit name=submit onclick="return save(),!1"></td></tr></table></form></div></body></html>