<!DOCTYPE html><html lang="zh"><head><title> BrewPiLess系統組態 </title><script>function s_ajax(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?t.success(e.responseText):e.onerror(e.status))},e.ontimeout=function(){void 0!==t.timeout?t.timeout():e.onerror(-1)},e.onerror=function(e){void 0!==t.fail&&t.fail(e)},e.open(t.m,t.url,!0),void 0!==t.data?(e.setRequestHeader("Content-Type",void 0!==t.mime?t.mime:"application/x-www-form-urlencoded"),e.send(t.data)):e.send()}var Q=function(e){return document.querySelector(e)}</script><script>function formatIP(a){return"0.0.0.0"==a?"":a}function verifyIP(a){var e=this.value.split("."),t=!0;if(4==e.length)for(var i=0;i<4;i++){if(255<parseInt(e[i])){t=!1;break}}else t=""==this.value;this.value=t?(this.saved=this.value,formatIP(this.value)):formatIP(this.saved)}function loadSetting(){s_ajax({url:"config?cfg=1",m:"GET",success:function(a){var t=JSON.parse(a);window.oridata=t,Object.keys(t).map(function(a){var e=Q("input[name="+a+"]");e?e.classList.contains("iptype")?(e.value=formatIP(t[a]),e.saved=t[a],e.onchange=verifyIP):"checkbox"==e.type?e.checked=0!=t[a]:e.value=t[a]:(e=Q("select[name="+a+"]"))&&(e.value=t[a])})},fail:function(a){alert("error getting data:"+a)}})}function waitrestart(){Q("#waitprompt").style.display="block",Q("#inputform").style.display="none",setTimeout(function(){window.location.reload()},15e3)}function save(){var i=document.querySelectorAll("input"),n={},o=!1;Object.keys(i).map(function(a,e){var t;"submit"!=i[e].type&&(i[e].name&&""!=i[e].name&&(t=i[e].classList.contains("iptype")?i[e].saved:"checkbox"==i[e].type?i[e].checked?1:0:i[e].value.trim(),n[i[e].name]=t,window.oridata[i[e].name]==t||i[e].classList.contains("nb")||(o=!0)))});var a=Q("select[name=wifi]");window.oridata.wifi!=a.value&&(o=!0),n.wifi=a.value,console.log(JSON.stringify(n)),s_ajax({url:"config"+(o?"":"?nb"),data:"data="+encodeURIComponent(JSON.stringify(n)),m:"POST",success:function(a){o&&waitrestart()},fail:function(a){alert("error saving data:"+a)}})}function load(){Q("#verinfo")&&(Q("#verinfo").innerHTML="v"+JSVERSION),loadSetting()}</script><style>#waitprompt{display:none}</style></head><body onload=load()><div id=waitprompt> 設定已儲存，等待重新啓動中。請注意：如果有更改主機名稱，自動載入不會成功。 </div><div id=inputform><form action=/setconfig action=post><table><tr><td> LCD自動關閉 </td><td><input name=aoff type=text size=5 maxlength=5 class=nb> 秒 </td></tr><tr><td> 網頁名稱 </td><td><input name=title type=text size=12 maxlength=24></td></tr><tr><td> 網路主機名稱 </td><td><input name=name type=text size=12 maxlength=16></td></tr><tr><td> HTTP Port </td><td><input name=port type=text size=5 maxlength=5></td></tr><tr><td> 使用者名稱 </td><td><input name=user type=text size=12 maxlength=16></td></tr><tr><td> 密碼 </td><td><input name=pass type=password size=12 maxlength=16></td></tr><tr><td> 全部頁面要求密碼 </td><td><input type=checkbox name=protect></td></tr><tr><td> 網路設定 </td><td><select name=wifi><option value=1>Station</option><option value=2>AP</option><option value=3>Station + AP</option></select></td></tr><tr><td> 固定IP </td><td><input type=text name=ip size=16 class=iptype></td></tr><tr><td> Gateway </td><td><input type=text name=gw size=16 class=iptype></td></tr><tr><td> Netmask </td><td><input type=text name=mask size=16 class=iptype></td></tr><tr><td> 儲存變更 </td><td><input type=submit name=submit onclick="return save(),!1"></td></tr></table></form></div></body></html>